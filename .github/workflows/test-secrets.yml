name: Test Secrets

on:
  workflow_dispatch:

jobs:
  test-secrets:
    name: Test if secrets are accessible
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Secrets
        env:
          ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
          ARM_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
          ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
        run: |
          echo "Checking secrets..."
          if [ -z "$ARM_CLIENT_ID" ]; then 
            echo "❌ ARM_CLIENT_ID is EMPTY or NOT SET"
            exit 1
          else
            echo "✅ ARM_CLIENT_ID is set (length: ${#ARM_CLIENT_ID})"
          fi
          
          if [ -z "$ARM_CLIENT_SECRET" ]; then 
            echo "❌ ARM_CLIENT_SECRET is EMPTY or NOT SET"
            exit 1
          else
            echo "✅ ARM_CLIENT_SECRET is set (length: ${#ARM_CLIENT_SECRET})"
          fi
          
          if [ -z "$ARM_SUBSCRIPTION_ID" ]; then 
            echo "❌ ARM_SUBSCRIPTION_ID is EMPTY or NOT SET"
            exit 1
          else
            echo "✅ ARM_SUBSCRIPTION_ID is set (length: ${#ARM_SUBSCRIPTION_ID})"
          fi
          
          if [ -z "$ARM_TENANT_ID" ]; then 
            echo "❌ ARM_TENANT_ID is EMPTY or NOT SET"
            exit 1
          else
            echo "✅ ARM_TENANT_ID is set (length: ${#ARM_TENANT_ID})"
          fi
          
          echo ""
          echo "All secrets appear to be set correctly!"
          
      - name: Test Azure Login
        run: |
          az login --service-principal \
            -u $ARM_CLIENT_ID \
            -p $ARM_CLIENT_SECRET \
            --tenant $ARM_TENANT_ID
          
          az account set --subscription $ARM_SUBSCRIPTION_ID
          
          echo "✅ Azure login successful!"
          
          az account show
